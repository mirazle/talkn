db.Threads.find({}, {connection: 1}).forEach((t)=>{ db.Threads.update( {connection: t.connection}, {$set:{postCnt: db.Posts.find( {connection: t.connection } ).size() } } );